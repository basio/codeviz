
# -------------------------------------------------------------------------------------------------
# BUILD FROM IMAGE: phusion/passenger-full
#
#	DOCUMENTATION:
# 				 URL: github.com/phusion/passenger-docker
#		VERSION-INFO: github.com/phusion/passenger-docker/blob/master/Changelog.md
# -------------------------------------------------------------------------------------------------

FROM phusion/passenger-full:latest
MAINTAINER Ernst Salzmann <ErnstSalzmann@gmail.com>

# -------------------------------------------------------------------------------------------------
# Set correct environment variables.
# -------------------------------------------------------------------------------------------------

ENV HOME /tmp

# -------------------------------------------------------------------------------------------------
# Run baseimage-docker's init process.
# -------------------------------------------------------------------------------------------------

CMD ["/sbin/my_init"]

# -------------------------------------------------------------------------------------------------
# expose port 80 and 433
# -------------------------------------------------------------------------------------------------

EXPOSE 80 443 3000 3001 8080

# -------------------------------------------------------------------------------------------------
# Define working directory.
# -------------------------------------------------------------------------------------------------

WORKDIR /vagrant

# -------------------------------------------------------------------------------------------------
# LINUX
# -------------------------------------------------------------------------------------------------

# update
RUN apt-get -y update

# python
RUN apt-get install -y python-dev

# -------------------------------------------------------------------------------------------------
# PYTHON: EASY_INSTALL & PIP
# -------------------------------------------------------------------------------------------------

# install easy_install
RUN curl https://bootstrap.pypa.io/ez_setup.py -o - | python

# install pip
RUN easy_install pip

# -------------------------------------------------------------------------------------------------
# ZERORPC
# -------------------------------------------------------------------------------------------------

# install ZeroMQ
RUN apt-get install -y libzmq3-dev

# install Python-ZeroRPC
RUN pip install zerorpc

# install NodeJS-ZeroRPC
RUN npm install -g zerorpc

# -------------------------------------------------------------------------------------------------
# METEOR
# -------------------------------------------------------------------------------------------------

# Install Meteor
RUN curl https://install.meteor.com | /bin/sh

# Install Meteorite
RUN npm install -g meteorite

# -------------------------------------------------------------------------------------------------
# LINUX
# -------------------------------------------------------------------------------------------------

RUN apt-get clean

# -------------------------------------------------------------------------------------------------
# ENTRYPOINT
# -------------------------------------------------------------------------------------------------

ENTRYPOINT ["/vagrant/startup.sh"]

# -------------------------------------------------------------------------------------------------
# END
# -------------------------------------------------------------------------------------------------
